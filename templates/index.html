<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Info Browser</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div>
                    <h1>Media Info Browser</h1>
                    <p>Analyze Media Files and Streams</p>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button id="dashboard-btn" class="settings-btn">üìä Dashboard</button>
                    <button id="settings-btn" class="settings-btn">‚öôÔ∏è Settings</button>
                </div>
            </div>
        </div>

        <div id="breadcrumb" class="breadcrumb" style="display: none;">
            <!-- Breadcrumb will be populated by JavaScript -->
        </div>

        <div id="back-button-container"></div>

        <div id="loading" class="loading">
            Loading media files...
        </div>

        <div id="error" class="error" style="display: none;">
            <!-- Error messages will be shown here -->
        </div>

        <div id="content" class="grid">
            <!-- Content will be populated by JavaScript -->
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Codec Compatibility Settings</h2>
                <button class="close" id="close-settings">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Problematic Audio Codecs</label>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                    Select audio codecs that cause issues in your streaming setup. Files with these codecs in the primary audio track will be flagged for remuxing.
                </p>
                <div id="audio-codec-selector" class="codec-selector">
                    <!-- Audio codec checkboxes will be populated by JavaScript -->
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Problematic Video Codecs</label>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                    Select video codecs that cause issues in your streaming setup. Files with these codecs will be flagged for remuxing.
                </p>
                <div id="video-codec-selector" class="codec-selector">
                    <!-- Video codec checkboxes will be populated by JavaScript -->
                </div>
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <button id="save-settings" class="save-btn">üíæ Save Settings</button>
            </div>

            <div id="settings-status" style="display: none;"></div>
        </div>
    </div>

    <!-- Dashboard Modal -->
    <div id="dashboard-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">Media Library Dashboard</h2>
                <button class="close" id="close-dashboard">&times;</button>
            </div>
            
            <div id="dashboard-loading" style="text-align: center; padding: 2rem;">
                <div class="loading">Loading library analysis...</div>
            </div>
            
            <div id="dashboard-content" style="display: none;">
                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="dashboard-card">
                        <div class="dashboard-number" id="total-files">-</div>
                        <div class="dashboard-label">Total Files</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-number" id="compatible-files">-</div>
                        <div class="dashboard-label">Compatible</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-number" id="problematic-files">-</div>
                        <div class="dashboard-label">Need Remux</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-number" id="compatibility-percentage">-</div>
                        <div class="dashboard-label">Compatibility</div>
                    </div>
                </div>

                <!-- Issue Breakdown -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Issue Breakdown</h3>
                        <div class="dashboard-stat">
                            <span>Audio Issues:</span>
                            <span id="audio-issues">-</span>
                        </div>
                        <div class="dashboard-stat">
                            <span>Video Issues:</span>
                            <span id="video-issues">-</span>
                        </div>
                        <div class="dashboard-stat">
                            <span>Both Issues:</span>
                            <span id="both-issues">-</span>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Actions</h3>
                        <button id="analyze-library" class="save-btn" style="margin-bottom: 0.5rem; width: 100%;">
                            üîç Analyze Library
                        </button>
                        <button id="export-csv" class="save-btn" style="margin-bottom: 0.5rem; width: 100%;">
                            üìÑ Export CSV
                        </button>
                        <button id="refresh-analysis" class="save-btn" style="width: 100%;">
                            üîÑ Refresh Analysis
                        </button>
                    </div>
                </div>

                <!-- Problematic Files List -->
                <div>
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Files Requiring Remux</h3>
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border); border-radius: var(--radius);">
                        <table id="problematic-files-table" style="width: 100%; border-collapse: collapse;">
                            <thead style="background: var(--background); position: sticky; top: 0;">
                                <tr>
                                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border);">File</th>
                                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border);">Issues</th>
                                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border);">Size</th>
                                </tr>
                            </thead>
                            <tbody id="problematic-files-body">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="dashboard-error" style="display: none; text-align: center; padding: 2rem; color: var(--text-secondary);">
                <!-- Error message will be shown here -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/media-browser.js') }}"></script>
    <script src="{{ url_for('static', filename='js/settings-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>